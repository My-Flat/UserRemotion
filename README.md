# MyFlat User Remotion

The intentiopn of this service is to provide a simple way to remove users from every other microservice where the user is present.
It must at first revoke every opened session, then enqueue the user for deletion in a temporary table on its own database, and finally call the other microservices to remove the user from their databases with their information.

## Data Model

Due to flexibility, the selected DB is a NoSQL one. The data model is as follows:

```json
"user_removal_queue": {
    "user_id": "string",
    "confirmation_token": "string",
    "confirmed": "boolean",
    "pending_serices_to_be_removed": ["string"],
    "deletion_triggered_at": "datetime"
},
"services": {
    "service_name": "string",
    "service_endpoint": "string",
}
```

## Endpoints

### POST /user/remove

This endpoint is responsible for removing a user from every other microservice. It must receive a JSON with the following structure:

```json
{
    "user_id": "string",
    "cofirmation_token": "string",
}
```



#### Responses

##### 200 OK

```json
{
    "message": "User removal triggered successfully"
}
```

This response is returned when the user is inserted into the temporary table and the deletion process is triggered. As the goal of the service itself is to empty its own database as soon as possible, it does not wait for the deletion to be completed in the other microservices, but does wait the response for the insertion of their own databases for removal.

##### 400 Bad Request

```json
{
    "message": "Invalid request"
}
```

This response is returned when the request body is not in the expected format.

##### 500 Internal Server Error

```json
{
    "message": "Internal server error"
}
```

This response is returned when an unexpected error occurs. It is recommended to check the logs for more information.

### POST /user/request_removal

This endpoint is responsible for requesting the removal of a user from every other microservice. It must receive a JSON with the following structure:

```json
{
    "user_id": "string",
}
```

This will look at users registered mail and send the link with the endpoint and the confirmation token to the user. This makes the user feels removal was made in just one click and instantly.

#### Responses

##### 200 OK

```json
{
    "message": "User removal requested successfully"
}
```

##### 400 Bad Request

```json
{
    "message": "Invalid request"
}
```

User ID is not in the expected format, or the user does not exist.

## Permissions

The service will be consumed throught its endpoint and can be accessed by anyone with the user ID and the confirmation token. The confirmation token is a random string generated by the service itself 